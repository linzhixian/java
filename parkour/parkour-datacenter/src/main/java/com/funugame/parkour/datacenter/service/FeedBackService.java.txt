package com.funugame.parkour.datacenter.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.funugame.parkour.api.IUserFeedBackService;
import com.funugame.parkour.api.IUserMessageService;
import com.funugame.parkour.api.daoentity.UserFeedBack;
import com.funugame.parkour.dao.UserFeedBackMapper;

@Service("feedBackService_RMI")
public class FeedBackService implements IUserFeedBackService {

    @Autowired
    private UserFeedBackMapper userFeedBackMapper;
    @Autowired
    private IUserMessageService userMessageService;

    @Override
    public int content(UserFeedBack ufb) {
	int ctt = 0;
	try {
	    if (ufb.getContent()!=null||ufb.equals("")) {
		ufb.setUid(ufb.getUid());
		ctt = userFeedBackMapper.insert(ufb);
		//反馈消息
		userMessageService.setUserFeedBackMessage(ufb);
	    }
	} catch (Exception e) {
	    e.printStackTrace();
	}

	return ctt;
    }
    
    @Override
    public List<UserFeedBack> queryList(String timeFrom,String timeTo,int reply,Integer deviceType) {
	return userFeedBackMapper.queryList(timeFrom, timeTo, reply,deviceType);
    }

    @Override
    public void updateReply(Integer id,Integer uid,String reply,String rtime) {
	    userFeedBackMapper.updateReply(id,reply);
	  //反馈消息
	    String msg="["+rtime+"反馈回复]"+reply;
	  userMessageService.sendFeedBackReply(uid,msg);
    }
}
