package com.funugame.gameadmin.web.command;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Service;

import com.funugame.gameadmin.web.gameadmin.DataGridResult;
import com.funugame.parkour.api.IUserService;
import com.funugame.parkour.api.daoentity.Notice;
import com.lzx.framework.web.springjson.annotation.WebAction;
import com.lzx.framework.web.springjson.annotation.WebCommand;
import com.lzx.framework.web.springjson.beans.ResponseBase;

@WebCommand
@Service
@Lazy
public class NoticeCommands {
    @Autowired
    private IUserService userService;

    @WebAction(name = "notice")
    public DataGridResult notice(Notice nt) {
	DataGridResult r = new DataGridResult();
	List<Notice> list = userService.selectNoticeList(nt);
	List<Notice> noticelist=new ArrayList<Notice>();
	for (int i = 0; i < list.size(); i++) {
	    nt = list.get(i);
	    if (new Date().getTime() < nt.getEndtime().getTime() && new Date().getTime() > nt.getStarttime().getTime()) {
		nt.setStatus("已发送");
	    }else if (new Date().getTime() < nt.getStarttime().getTime()) {
		nt.setStatus("待发送");
	    }else if (new Date().getTime() > nt.getEndtime().getTime()) {
		nt.setStatus("已下线");
	    }
	    noticelist.add(nt);
	    nt=new Notice();
	}
	r = new DataGridResult(noticelist.size(), noticelist);
	if (noticelist.size() > 0) {
	    r.setCode(ResponseBase.SUCCESS);
	} else if (noticelist.size() <= 0) {
	    r.setCode(ResponseBase.EXIST);
	}
	return r;
    }
    
    @WebAction(name = "deleteNotice")
    public DataGridResult deleteNotice(Notice nt) {
	DataGridResult r = new DataGridResult();
	int i=userService.deleteNoticeList(nt);
	if (i != 0) {
	    r.setCode(ResponseBase.SUCCESS);
	} else if (i== 0) {
	    r.setCode(ResponseBase.EXIST);
	}
	return r;
    }
    
    @WebAction(name = "insertNotice")
    public DataGridResult insertNotice(Notice nt) {
	DataGridResult r = new DataGridResult();
	int i=userService.insertNoticeList(nt);
	if (i != 0) {
	    r.setCode(ResponseBase.SUCCESS);
	} else if (i== 0) {
	    r.setCode(ResponseBase.EXIST);
	}
	return r;
    }
    
    @WebAction(name = "updateNotice")
    public DataGridResult updateNotice(Notice nt) {
	DataGridResult r = new DataGridResult();
	int i=userService.updateNoticeList(nt);
	if (i != 0) {
	    r.setCode(ResponseBase.SUCCESS);
	} else if (i== 0) {
	    r.setCode(ResponseBase.EXIST);
	}
	return r;
    }
    
    @WebAction(name = "gameNotice")
    public DataGridResult gameNotice(Notice nt) {
	DataGridResult r = new DataGridResult();
	List<Notice> list = userService.selectNoticeList(nt);
	List<Notice> noticelist=new ArrayList<Notice>();
	for (int i = 0; i < list.size(); i++) {
	    nt = list.get(i);
	    if (new Date().getTime() < nt.getEndtime().getTime() && new Date().getTime() > nt.getStarttime().getTime()) {
		nt.setStatus("已发送");
	    }else if (new Date().getTime() < nt.getStarttime().getTime()) {
		nt.setStatus("待发送");
	    }else if (new Date().getTime() > nt.getEndtime().getTime()) {
		nt.setStatus("已下线");
	    }
	    noticelist.add(nt);
	    nt=new Notice();
	}
	r = new DataGridResult(noticelist.size(), noticelist);
	if (noticelist.size() > 0) {
	    r.setCode(ResponseBase.SUCCESS);
	} else if (noticelist.size() <= 0) {
	    r.setCode(ResponseBase.EXIST);
	}
	return r;
    }
}
