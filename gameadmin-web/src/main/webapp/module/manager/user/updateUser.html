<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<script>
		$('#btn').linkbutton({
			iconCls : 'icon-save'
		});
		$(function() {
			$('#btn').bind('click', function() {
				var nodes2 = $('#tt').tree('getChecked','indeterminate');
				 var nodes = $('#tt').tree('getChecked');
				 var s2='';
				 for(var k=0;k<nodes2.length;k++){
					 if (s2 != '')
                    s2 += ',';
                	 s2 += '"';
					 var n2=nodes2[k].text;
					for(var x=0;x<8;x++){
						if(n2=="游戏后台"){
                   		n2="menu_gameadmin";
                   	}
						if(n2=="系统管理"){
                   		n2="menu_manager";
                   	}
					}
					s2 +=n2;
                   s2 += '"';
				}
	                var s = '[';
	                s+=s2;
	                alert(s);
	                for (var i = 0; i < nodes.length; i++) {
	                    if (s != '[')
	                        s += ',';
	                    s += '"';
	                    var n=nodes[i].text;
	                    for(var j=0;j<8;j++){
	                    	if(n=="游戏后台"){
	                    		n="menu_gameadmin";
	                    	}
	                    	if(n=="账号信息查询"){
	                    		n="m_userinfo";
	                    	}
	                    	if(n=="用户反馈"){
	                    		n="m_feedback";
	                    	}
							if(n=="道具发放"){
	                    		n="m_props";
	                    	} 
							if(n=="公告系统"){
	                    		n="m_notice";
	                    	} 
							if(n=="交易记录查询"){
	                    		n="m_userforbidden";
	                    	}
							if(n=="系统管理"){
	                    		n="menu_manager";
	                    	}
							if(n=="用户管理"){
	                    		n="m_adminuser";
	                    	}
	                    }
	                    s +=n;
	                    s += '"';
	                }
	                s+=']';
                    if(s=="[]"){
                    	$.messager.alert('提示', '请选择用户权限');
                    	return;
                    }
                var mtree=s;
                $.onSubmitClick(this, $.submitSendmessageResult, false,mtree);
			});
		});
		$.submitSendmessageResult = function(jsonResult) {
			var code = jsonResult["code"];
			if (code == 1) {
				//$.messager.show('提示','发送完毕');
				$.messager.show({
					title : '提示',
					msg : '操作完毕',
					timeout : 3000,
					showType : 'slide'
				});
				$('#dd').window('close');
				window.location.reload();

			} else if (code == 7) {
				$.messager.alert('错误', '操作失败!');

			} else {
				$.messager.alert('警告', '发送失败！错误码:' + code);
			}
		}
		function Menu_Tree() {
			var userid=$("#id").val();
			var mt={"modifyMenuTree":{"id":userid}};
			$.submitMenutreeResult = function(jsonResult) {
				var tree_data2=jsonResult["modifyMenuTreeResponse"]["rows"];
				var tree_data=[{    
				    "id":0,    
				    "text":"跑酷",    
				    "children":tree_data2  
				    }];
				$('#tt').tree({
					checkbox:true, 
				    data: tree_data
				});
			}
			$.submitControl(mt,$.submitMenutreeResult);
			 
		}
	</script>
	<br>
	<form id="ff" method="get">
		<table width="300" align="center">
			<tr>
				<td align="center"><input id="id"  name="id" type="text" style="display:none"></td>
			</tr>
			<tr>
				<td>用户名:</td>
				<td><input class="easyui-validatebox" type="text" id="name" name="name" data-options="required:true" missingMessage="用户名必须填写" /></td>
			</tr>
			<tr>
				<td>新密码:</td>
				<td><input class="easyui-validatebox" type="text" id="password" name="password" data-options="required:true" missingMessage="密码必须填写" /></td>
			</tr>
			<tr>
				<td>
					<div>
						<ul id="tt" ></ul>
					</div>
				</td>
			</tr>
			<tr>
				<td align="right">
					<div>
						<a id="btn" href="#" name="updateAdminUser">保存</a>
					</div>
				</td>
			</tr>
		</table>
	</form>
</body>
</html>